@using Microsoft.AspNet.Identity;
@model IEnumerable<bug_tracker.Models.Ticket>
@{
    ViewBag.Title = "Ticket Index";
}
<div class="container">
    <h2>Ticket Manager</h2>
    <a href="@Url.Action("Create")" style="text-decoration:none; color: darkblue;">Create New Ticket</a>
    <br />
    <small>*Click the name of the ticket to get more details*</small>
    <hr />
    <table class="no-footer display" id="ticketsTable">
        <thead>
            <tr>
                <th>   
                    Title
                </th>
                <th>
                    Owner
                </th>
                <th>
                    Status
                </th>
                <th>
                    Priority
                </th>
                <th>
                    Type
                </th>
                <th>
                    Project
                </th>
                <th>
                    Assigned Developer
                </th>
            </tr>
        </thead>
        <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    <a href="@Url.Action("Details", new { id = item.Id })">
                        @item.Title
                    </a>
                    @if (User.IsInRole("Admin,Global Admin") || User.IsInRole("Global Admin") || User.IsInRole("Project Manager") || item.AssignedToUserId == User.Identity.GetUserId())
                    {
                        <a class="glyphicon glyphicon-pencil pull-right" href="@Url.Action("Edit", new { id = item.Id})"
                           style="text-decoration:none;"></a>
                    }
                </td>
                <td>@item.Owner.DisplayName</td>
                <td>@item.Status.Name</td>
                <td>@item.Priority.Name</td>
                <td>@item.Type.Name</td>
                <td>@item.Project.Title</td>
                @if (item.AssignedToUser != null)
                {
                    <td>
                        @item.AssignedToUser.DisplayName
                    </td>
                }
                else
                {
                    <td>
                        None Assigned Currently
                    </td>
                }
            </tr>
        }
        </tbody>
    </table>
</div>
@section scripts{
    <script>
    $(document).ready(function () {
        $('#ticketsTable').dataTable();
    });
    </script>
}