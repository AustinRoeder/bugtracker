@model IEnumerable<bug_tracker.Models.TicketChartDetails>
@{
    ViewBag.Title = "Home Index";
    var colors = new string[] { "red", "green", "blue"};
    var i = 0;
    var j = 0;
}
<div class="row">
    <div class="col-md-12">
    @if(User.IsInRole("Global Admin") || User.IsInRole("Admin"))
    { 
        <div class="row">
            <div class="col-md-6">
                <div class="portlet">
                    <div class="portlet-header">
                        <h3>
                            <i class="fa fa-bar-chart-o"></i>
                            Ticket Progress
                        </h3>
                    </div> <!-- /.portlet-header -->
                    <div class="portlet-content">
                        <div id="ticket-donut"></div>
                    </div> <!-- /.portlet-content -->
                </div> <!-- /.portlet -->
            </div> <!-- Donut -->
            <div class="col-md-6">
                <div class="portlet">
                    <div class="portlet-header">
                        <h3>
                            <i class="fa fa-folder-open-o"></i>
                            Project Overview
                        </h3>
                    </div> <!-- /.portlet-header -->
                    <div class="portlet-content panel-thread scrollable-panel" tabindex="5000" style="overflow: hidden; outline: none;">
                        <ul class="panel-lists" id="projectOverview">
                            @foreach (var obj in Model.OrderBy(t=>t.PercentCompleted))
                            {                    
                                <li>
                                    <div class="progress-stat">

                                        <div class="progress-stat-label">
                                            @obj.Title
                                            <br />
                                            <small>Completed tickets: @(obj.PercentCompleted / 100 * obj.TicketCount) of @(obj.TicketCount)</small>
                                        </div> <!-- /.stat-label -->

                                        <div class="progress-stat-value">
                                            @obj.PercentCompleted%
                                        </div> <!-- /.stat-value -->

                                        <div class="progress progress-striped active">
                                            <div class="progress-bar progress-bar-@colors[i%3]" role="progressbar"
                                                 aria-valuenow="@obj.PercentCompleted" aria-valuemin="0" aria-valuemax="100" style="width: @(obj.PercentCompleted)%">
                                                <span class="sr-only">@obj.PercentCompleted% Complete</span>
                                            </div>
                                        </div> <!-- /.progress -->
                                    </div>
                                </li>
                                i++;
                            }
                        </ul> <!-- /.projectList -->
                    </div> <!-- /.portlet-content -->
                </div> <!-- /.portlet -->
            </div>
            <div class="portlet portlet-table">
                <div class="portlet-header">
                    <h3>
                        <i class="fa fa-group"></i>
                        Recent Signups
                    </h3>
                    <ul class="portlet-tools pull-right">
                        <li>
                            <button class="btn btn-sm btn-default">
                                Add User
                            </button>
                        </li>
                    </ul>
                </div> <!-- /.portlet-header -->
                <div class="portlet-content">

                    <div class="table-responsive">
                        <table id="user-signups" class="table table-striped table-bordered table-checkable">
                            <thead>
                                <tr>
                                    <th class="checkbox-column">
                                        <div class="icheckbox_minimal-blue icheck-input" style="position: relative;"><input type="checkbox" id="check-all" class="icheck-input" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div>
                                    </th>
                                    <th class="hidden-xs">First Name</th>
                                    <th>Last Name</th>
                                    <th>Status</th>
                                    <th class="text-center" style="width: 90px">Approve</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="checkbox-column">
                                        <div class="icheckbox_minimal-blue icheck-input" style="position: relative;"><input type="checkbox" name="actiony" value="joey" class="icheck-input" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div>
                                    </td>
                                    <td class="hidden-xs">Joey</td>
                                    <td>Greyson</td>
                                    <td><span class="label label-success">Approved</span></td>
                                    <td class="text-center">
                                        <a href="javascript:void(0);" class="btn btn-xs btn-primary" data-original-title="Approve">
                                            <i class="fa fa-check"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="checkbox-column">
                                        <div class="icheckbox_minimal-blue icheck-input" style="position: relative;"><input type="checkbox" name="actiony" value="wolf" class="icheck-input" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div>
                                    </td>
                                    <td class="hidden-xs">Wolf</td>
                                    <td>Bud</td>
                                    <td>
                                        <span class="label label-default">Pending</span>
                                    </td>
                                    <td class="text-center">
                                        <a href="javascript:void(0);" class="btn btn-xs btn-primary" data-original-title="Approve">
                                            <i class="fa fa-check"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="checkbox-column">
                                        <div class="icheckbox_minimal-blue icheck-input" style="position: relative;"><input type="checkbox" name="actiony" value="sam" class="icheck-input" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div>
                                    </td>
                                    <td class="hidden-xs">Sam</td>
                                    <td>Mitchell</td>
                                    <td><span class="label label-success">Approved</span></td>
                                    <td class="text-center">
                                        <a href="javascript:void(0);" class="btn btn-xs btn-primary" data-original-title="Approve">
                                            <i class="fa fa-check"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="checkbox-column">
                                        <div class="icheckbox_minimal-blue icheck-input" style="position: relative;"><input type="checkbox" value="carlos" name="actiony" class="icheck-input" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div>
                                    </td>
                                    <td class="hidden-xs">Carlos</td>
                                    <td>Lopez</td>
                                    <td><span class="label label-success">Approved</span></td>
                                    <td class="text-center">
                                        <a href="javascript:void(0);" class="btn btn-xs btn-primary" data-original-title="Approve">
                                            <i class="fa fa-check"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="checkbox-column">
                                        <div class="icheckbox_minimal-blue icheck-input" style="position: relative;"><input type="checkbox" name="actiony" value="rob" class="icheck-input" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div>
                                    </td>
                                    <td class="hidden-xs">Rob</td>
                                    <td>Johnson</td>
                                    <td><span class="label label-default">Pending</span></td>
                                    <td class="text-center">
                                        <a href="javascript:void(0);" class="btn btn-xs btn-primary" data-original-title="Approve">
                                            <i class="fa fa-check"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="checkbox-column">
                                        <div class="icheckbox_minimal-blue icheck-input" style="position: relative;"><input type="checkbox" value="mike" name="actiony" class="icheck-input" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div>
                                    </td>
                                    <td class="hidden-xs">Mike</td>
                                    <td>Jones</td>
                                    <td><span class="label label-default">Pending</span></td>
                                    <td class="text-center">
                                        <a href="javascript:void(0);" class="btn btn-xs btn-primary" data-original-title="Approve">
                                            <i class="fa fa-check"></i>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                    </div> <!-- /.table-responsive -->
                </div> <!-- /.portlet-content -->
                <div class="portlet-footer">
                    <div class="text-right">
                        Apply to Selected: &nbsp;&nbsp;
                        <div class="select2-container ui-select2" id="s2id_apply-selected" style="width: 125px"><a href="javascript:void(0)" onclick="return false;" class="select2-choice" tabindex="-1">   <span class="select2-chosen">Select Action</span><abbr class="select2-search-choice-close"></abbr>   <span class="select2-arrow"><b></b></span></a><input class="select2-focusser select2-offscreen" type="text" id="s2id_autogen1"><div class="select2-drop select2-display-none select2-with-searchbox">   <div class="select2-search">       <input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="select2-input">   </div>   <ul class="select2-results">   </ul></div></div><select id="apply-selected" name="table-select" class="ui-select2 select2-offscreen" style="width: 125px" tabindex="-1">
                            <option value="">Select Action</option>
                            <option value="approve">Approve</option>
                            <option value="edit">Edit</option>
                            <option value="delete">Delete</option>
                        </select>
                    </div>
                </div> <!-- /.portlet-footer -->
            </div> <!-- /.portlet -->
        </div><!-- /.row -->
    }
    else if (User.IsInRole("Project Manager") || User.IsInRole("Developer"))
    {
        <div class="row">
            <div class="col-md-6">
                <div class="portlet">
                    <div class="portlet-header">
                        <h3>
                            <i class="fa fa-bar-chart-o"></i>
                            Ticket Progress
                        </h3>
                    </div> <!-- /.portlet-header -->
                    <div class="portlet-content">
                        <div id="ticket-donut"></div>
                    </div> <!-- /.portlet-content -->
                </div> <!-- /.portlet -->
            </div> <!-- Donut -->
            <div class="col-md-6">
                <div class="portlet">
                    <div class="portlet-header">
                        <h3>
                            <i class="fa fa-folder-open-o"></i>
                            Project Overview
                        </h3>
                    </div> <!-- /.portlet-header -->
                    <div class="portlet-content panel-thread scrollable-panel" tabindex="5000" style="overflow: hidden; outline: none;">
                        <ul class="panel-lists" id="projectOverview">
                            @foreach (var obj in Model)
                            {
                                <li>
                                    <div class="progress-stat">

                                        <div class="progress-stat-label">
                                            @obj.Title
                                        </div> <!-- /.stat-label -->

                                        <div class="progress-stat-value">
                                            @obj.PercentCompleted%
                                        </div> <!-- /.stat-value -->

                                        <div class="progress progress-striped active">
                                            <div class="progress-bar progress-bar-@colors[j%3]" role="progressbar" aria-valuenow="@obj.PercentCompleted" aria-valuemin="0" aria-valuemax="100" style="width: @(obj.PercentCompleted)%">
                                                <span class="sr-only">@obj.PercentCompleted% Complete</span>
                                            </div>
                                        </div> <!-- /.progress -->
                                    </div>
                                </li>
                                j++;
                            }
                        </ul> <!-- /.projectList -->
                    </div> <!-- /.portlet-content -->
                </div> <!-- /.portlet -->
            </div>
        </div><!-- /.row -->
    }
    </div> <!-- /.col -->
</div> <!-- /.row -->
@section scripts{
    <script>
        $(window).load(function () {
            console.log("In docuemnt ready");
            $.post('@Url.Action("GetChart", "Home")').then(function (response) {
                console.log(response);
                new Morris.Donut({
                    element: 'ticket-donut',
                    data: response.donut,
                    //label: 'Name',
                    //value: 'Value',
                    resize: true
                });
            $('.scrollable-panel').niceScroll()
                //console.log(response.progress);
                //var colors = ["primary", "green", "blue"];
                //for(var i = 0; i < response.progress.length; i++)
                //{
                //    var progI = response.progress[i];
                //    console.log(progI);
                //    $('#projectOverview').append(
                //            "<li>"+
                //                "<div class='progress-stat'>"+
                //                    "<div class='progress-stat-label'>"+
                //                        progI.label+
                //                    "</div> <!-- /.stat-label -->"+
                //                    "<div class='progress progress-striped active'>"+
                //                        "<div class='progress-bar progress-bar-" + colors[(i%3)] + "' role='progressbar'"+
                //                                "aria-valuenow='" + progI.value + "' aria-valuemin='0' aria-valuemax='100' style='width: " + progI.percent + "%'>" +
                //                                progI.value + " tickets" +
                //                        "<span class='sr-only'>" + progI.percent + "% of all Tickets</span>"+
                //                        "</div>"+
                //                    "</div> <!-- /.progress -->"+
                //                "</div> <!-- /.progress-stat -->"+
                //            "</li> <!-- /.progessListItem -->");
                //}
            })
        })
    </script>
}